<!doctype html>
<html lang="en-us">
  <head>
    <title>token - 令牌 // My New Hugo Site</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.72.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://xpropp.github.io/css/main.min.f90f5edd436ec7b74ad05479a05705770306911f721193e7845948fb07fe1335.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="token - 令牌"/>
<meta name="twitter:description" content="token - 令牌
JWT - json-web-token
1，三大组成 1，header
格式为字典-元数据格式如下
{&lsquo;alg&rsquo;:&lsquo;HS256&rsquo;, &lsquo;typ&rsquo;:&lsquo;JWT&rsquo;} #alg代表要使用的 算法 #typ表明该token的类别 - 此处必须为 大写的 JWT 该部分数据需要转成json串并用base64 加密
2，payload
格式为字典-此部分分为公有声明和私有声明
公共声明：JWT提供了内置关键字用于描述常见的问题
此部分均为可选项，用户根据自己需求 按需添加key，常见公共声明如下：
{&lsquo;exp&rsquo;:xxx, # Expiration Time 此token的过期时间的时间戳 &lsquo;iss&rsquo;:xxx，# (Issuer) Claim 指明此token的签发者 &lsquo;aud&rsquo;:xxx, #(Audience) Claim 指明此token的 &lsquo;iat&rsquo;:xxx, # (Issued At) Claim 指明此创建时间的时间戳 &lsquo;aud&rsquo;:xxx, # (Audience) Claim	指明此token签发面向群体 } 私有声明：用户可根据自己业务需求，添加自定义的key，例如如下：
{&lsquo;username&rsquo;: &lsquo;sunwukong&rsquo;} 公共声明和私有声明均在同一个字典中；转成json串并用base64加密
3，signature 签名
签名规则如下：
根据header中的alg确定 具体算法，以下用 HS256为例
HS256(自定义的key , base64后的header &#43; &lsquo;.&rsquo; &#43; base64后的payload)
解释：用自定义的key, 对base64后的header &#43; &lsquo;."/>

    <meta property="og:title" content="token - 令牌" />
<meta property="og:description" content="token - 令牌
JWT - json-web-token
1，三大组成 1，header
格式为字典-元数据格式如下
{&lsquo;alg&rsquo;:&lsquo;HS256&rsquo;, &lsquo;typ&rsquo;:&lsquo;JWT&rsquo;} #alg代表要使用的 算法 #typ表明该token的类别 - 此处必须为 大写的 JWT 该部分数据需要转成json串并用base64 加密
2，payload
格式为字典-此部分分为公有声明和私有声明
公共声明：JWT提供了内置关键字用于描述常见的问题
此部分均为可选项，用户根据自己需求 按需添加key，常见公共声明如下：
{&lsquo;exp&rsquo;:xxx, # Expiration Time 此token的过期时间的时间戳 &lsquo;iss&rsquo;:xxx，# (Issuer) Claim 指明此token的签发者 &lsquo;aud&rsquo;:xxx, #(Audience) Claim 指明此token的 &lsquo;iat&rsquo;:xxx, # (Issued At) Claim 指明此创建时间的时间戳 &lsquo;aud&rsquo;:xxx, # (Audience) Claim	指明此token签发面向群体 } 私有声明：用户可根据自己业务需求，添加自定义的key，例如如下：
{&lsquo;username&rsquo;: &lsquo;sunwukong&rsquo;} 公共声明和私有声明均在同一个字典中；转成json串并用base64加密
3，signature 签名
签名规则如下：
根据header中的alg确定 具体算法，以下用 HS256为例
HS256(自定义的key , base64后的header &#43; &lsquo;.&rsquo; &#43; base64后的payload)
解释：用自定义的key, 对base64后的header &#43; &lsquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xpropp.github.io/post/blog/" />
<meta property="article:published_time" content="2020-06-16T14:51:48+08:00" />
<meta property="article:modified_time" content="2020-06-16T14:51:48+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://xpropp.github.io"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <h1>My New Hugo Site</h1>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
      <div class="app-header-social">
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">token - 令牌</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 16, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div></div>
    </header>
    <div class="post-content">
      <p>token - 令牌</p>
<p>JWT - json-web-token</p>
<p>1，三大组成
1，header</p>
<p>格式为字典-元数据格式如下</p>
<p>{&lsquo;alg&rsquo;:&lsquo;HS256&rsquo;, &lsquo;typ&rsquo;:&lsquo;JWT&rsquo;}
#alg代表要使用的 算法
#typ表明该token的类别 - 此处必须为 大写的 JWT
该部分数据需要转成json串并用base64 加密</p>
<p>2，payload</p>
<p>格式为字典-此部分分为公有声明和私有声明</p>
<p>公共声明：JWT提供了内置关键字用于描述常见的问题</p>
<p>此部分均为可选项，用户根据自己需求 按需添加key，常见公共声明如下：</p>
<p>{&lsquo;exp&rsquo;:xxx, # Expiration Time 此token的过期时间的时间戳
&lsquo;iss&rsquo;:xxx，# (Issuer) Claim 指明此token的签发者
&lsquo;aud&rsquo;:xxx, #(Audience) Claim 指明此token的
&lsquo;iat&rsquo;:xxx, # (Issued At) Claim 指明此创建时间的时间戳
&lsquo;aud&rsquo;:xxx, # (Audience) Claim	指明此token签发面向群体
}
私有声明：用户可根据自己业务需求，添加自定义的key，例如如下：</p>
<p>{&lsquo;username&rsquo;: &lsquo;sunwukong&rsquo;}
公共声明和私有声明均在同一个字典中；转成json串并用base64加密</p>
<p>3，signature 签名</p>
<p>签名规则如下：</p>
<p>根据header中的alg确定 具体算法，以下用 HS256为例</p>
<p>HS256(自定义的key , base64后的header + &lsquo;.&rsquo; + base64后的payload)</p>
<p>解释：用自定义的key, 对base64后的header + &lsquo;.&rsquo; + base64后的payload进行hmac计算</p>
<p>2.jwt结果格式
base64(header) + &lsquo;.&rsquo; + base64(payload) + &lsquo;.&rsquo; + base64(sign)</p>
<p>最终结果如下： b&rsquo;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6Imd1b3hpYW9uYW8iLCJpc3MiOiJnZ2cifQ.Zzg1u55DCBqPRGf9z3-NAn4kbA-MJN83SxyLFfc5mmM&rsquo;</p>
<p>3.校验jwt规则
1，解析header, 确认alg</p>
<p>2，签名校验 - 根据传过来的header和payload按 alg指明的算法进行签名，将签名结果和传过来的sign进行对比，若对比一致，则校验通过</p>
<p>3，获取payload自定义内容</p>
<p>import hmac
import base64
import time
import json
import copy</p>
<p>class Jwt():
def <strong>init</strong>(self):
pass</p>
<pre><code>@staticmethod
def encode(payload, key, exp=300):
    # init header
    header = {'type': 'JWT', 'alg': 'HS256'}
    header_json = json.dumps(header, sort_keys=True, separators=(',', ':'))
    header_bs = Jwt.b64encode(header_json.encode())
    # init payload
    new_payload = copy.deepcopy(payload)
    new_payload['exp'] = time.time() + exp
    payload_json = json.dumps(new_payload, separators=(',', ':'), sort_keys=True)
    payload_bs = Jwt.b64encode(payload_json.encode())
    # init sign
    hm = hmac.new(key.encode(), header_bs + b'.' + payload_bs, digestmod='SHA256')
    hm_bs = Jwt.b64encode(hm.digest())
    return header_bs + b'.' + payload_bs + b'.' + hm_bs

@staticmethod
def b64encode(j_s):
    return base64.urlsafe_b64encode(j_s).replace(b'=', b'')

@staticmethod
def b64decode(b_s):

    rem = len(b_s) % 4
    if rem &gt; 0:
        b_s += b'=' * (4 - rem)
    return base64.urlsafe_b64decode(b_s)

@staticmethod
def decode(token, key):
    # 校验签名
    header_bs, payload_bs, sign = token.split(b'.')
    hm = hmac.new(key.encode(), header_bs + b'.' + payload_bs, digestmod='SHA256')
    if sign != Jwt.b64encode(hm.digest()):
        # token校验失败
        raise
    # 检查时间是否过期
    payload_js = Jwt.b64decode(payload_bs) # 字节串
    payload = json.loads(payload_js)
    p_exp = payload['exp']
    now = time.time()
    if now &gt; p_exp:
        # token失效了，过期
        raise
    return  payload
</code></pre>
<p>if <strong>name</strong> == &lsquo;<strong>main</strong>':
s = Jwt.encode({&lsquo;xx&rsquo;: &lsquo;j23j&rsquo;}, &lsquo;b2e&rsquo;, 300)
# time.sleep(2)
print(Jwt.decode(s,&lsquo;b2e&rsquo;))</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
